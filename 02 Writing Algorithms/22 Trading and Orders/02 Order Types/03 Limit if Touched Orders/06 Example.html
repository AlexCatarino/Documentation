<p>The following backtest verifies the <code>LimitOrder</code> behavior. The following table shows the first three trades in the backtest:</p>

<table class="qc-table table" id="research-nodes-table">
    <thead>
        <tr>
            <th>Submitted Time</th>
            <th>Filled Time</th>
            <th>Symbol</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Type</th>
            <th>Status</th>
            <th>Value</th>
            <th>Tag</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>2021-07-01T09:32:00Z</td>
            <td>2021-07-01T09:32:00Z</td>
            <td>SPY</td>
            <td>429.00</td>
            <td>10</td>
            <td>Limit</td>
            <td>Filled</td>
            <td>4290.00</td>
            <td></td>
        </tr>
        <tr>
            <td>2021-07-02T09:31:00Z</td>
            <td>2021-07-02T09:35:00Z</td>
            <td>SPY</td>
            <td>431.70</td>
            <td>-10</td>
            <td>Limit</td>
            <td>Filled</td>
            <td>-4317.00</td>
            <td></td>
        </tr>
        <tr>
            <td>2021-07-02T09:31:00Z</td>
            <td>/</td>
            <td>SPY</td>
            <td>400.00</td>
            <td>10</td>
            <td>Limit</td>
            <td>Submitted</td>
            <td>/</td>
            <td></td>
        </tr>
        <tr>
            <td>/</td>
            <td>/</td>
            <td>SPY</td>
            <td>400.00</td>
            <td>10</td>
            <td>Limit if touched</td>
            <td>Submitted</td>
            <td>/</td>
            <td></td>
        </tr>
    </tbody>
</table>

<style>
#research-nodes-table td:nth-child(3), 
#research-nodes-table th:nth-child(3), 
#research-nodes-table td:nth-child(4), 
#research-nodes-table th:nth-child(4), 
#research-nodes-table td:nth-child(7), 
#research-nodes-table th:nth-child(7) {
    text-align: right;
}
</style>

<p>The algorithm sets a condition that on the 1st July 9:31am, it would submit a limit-if-touched order to buy 10 shares of SPY at a limit price below $428.95 if the price of SPY ever touches $429.00. It is expected to be filled at the limit price for a liquid stock like SPY after it was triggered, since its trading price would most likely be continuous with high involvement of market makers. It turns out indeed it was filled at $429.00. Generally, for buy-limit-if-touched orders of both liquid and illquid assets, the filling price would be the minumum between the ask high price and limit price of the next bar that has ask low price below the limit price, after the triggered price was reached and the limit order was submitted.</p>

<p>Another condition would be on the 2nd July 9:31am, it would submit a limit-if-touched order to sell 10 shares of SPY at a limit price above $431.75 if the price of SPY ever touches $431.70. Just like the first order, it is expected that the limit order will be filled at the limit price, which indeed is true. Generally, for sell-limit-if-touched orders of both liquid and illquid assets, the filling price would be the maximum between the ask low price and limit price of the next bar that has ask high price above the limit price, after the triggered price was reached and the limit order was submitted.</p>

<p>The third order is submitted alongside with the second order. It will submit a limit order to buy 10 shares of SPY if its price was fallen below $400.00 once the price of SPY touched $431.70. It was being submitted since the triggered price was touched, but as the limit price was never met, it remained unfilled.</p>

<p>The fourth order is submitted alongside with the second order. It will submit a limit order to buy 10 shares of SPY if its price was fallen below $400.00 once the price of SPY touched $400.00. It was not being submitted since the triggered price was never touched.</p>

<p>To reproduce these results, backtest the following algorithm:</p>

<div class="python"><div class="qc-embed-frame" style="display: inline-block; position: relative; width: 100%; min-height: 100px; min-width: 300px;"><div class="qc-embed-dummy" style="padding-top: 56.25%;"></div><div class="qc-embed-element" style="position: absolute; top: 0; bottom: 0; left: 0; right: 0;"><iframe class="qc-embed-backtest" src="https://www.quantconnect.com/terminal/processCache?request=embedded_backtest_05e02071a20ed545a94d1489e7c050dc.html" style="max-width: calc(100vw - 30px); max-height: 100vw; overflow: hidden;" scrolling="no" width="100%" height="100%"></iframe></div></div></div>

<div class="csharp"><div class="qc-embed-frame" style="display: inline-block; position: relative; width: 100%; min-height: 100px; min-width: 300px;"><div class="qc-embed-dummy" style="padding-top: 56.25%;"></div><div class="qc-embed-element" style="position: absolute; top: 0; bottom: 0; left: 0; right: 0;"><iframe class="qc-embed-backtest" src="https://www.quantconnect.com/terminal/processCache?request=embedded_backtest_0a0bc17659fd3c3f271c9fcd6d9cd3e1.html" style="max-width: calc(100vw - 30px); max-height: 100vw; overflow: hidden;" scrolling="no" width="100%" height="100%"></iframe></div></div></div>
