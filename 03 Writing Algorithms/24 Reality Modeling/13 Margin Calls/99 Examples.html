<p>
 The following examples demonstrate common practices for implementing a custom margin call model.
</p>
<h4>
 Example 1: Default Model Wrapper
</h4>
<p>
 The following algorithm defines a subclass of the <code>DefaultMarginCallModel</code> and overrides its built-in members so you can easily customize the parts you need.
</p>

<div class="section-example-container testable">
 <pre class="csharp">public class CustomFillModelAlgorithm : QCAlgorithm
{
    public override void Initialize()
    {
        SetStartDate(2024, 9, 1);
        SetEndDate(2024, 12, 31);
        SetCash(100000);
        
        Portfolio.MarginCallModel = new MyMarginCallModel(Portfolio, DefaultOrderProperties);
        AddEquity("SPY", Resolution.Daily);
    }

    public override void OnData(Slice data)
    {
        if (!Portfolio.Invested)
        {
            SetHoldings("SPY", -2);
        }
    }
}

public class MyMarginCallModel : DefaultMarginCallModel
{
    public MyMarginCallModel(
        SecurityPortfolioManager portfolio,
        IOrderProperties defaultOrderProperties)
        : base(portfolio, defaultOrderProperties)
    {
    }

    public override List&lt;OrderTicket&gt; ExecuteMarginCall(
        IEnumerable&lt;SubmitOrderRequest&gt; generatedMarginCallOrders)
    {
        return base.ExecuteMarginCall(generatedMarginCallOrders);
    }

    public List&lt;SubmitOrderRequest&gt; GetMarginCallOrders(out bool issueMarginCallWarning)
    {
        return base.GetMarginCallOrders(out issueMarginCallWarning);
    }
}
</pre>
 <script class="csharp-result" type="text">
  {}
 </script>
 <pre class="python">class CustomFillModelAlgorithm(QCAlgorithm):

    def initialize(self) -> None:
        self.set_start_date(2024, 9, 1)
        self.set_end_date(2024, 12, 31)
        self.set_cash(100000)
        self.portfolio.set_margin_call_model(MyMarginCallModel(self.portfolio, self.default_order_properties))
        self.add_equity('SPY', Resolution.DAILY)

    def on_data(self, data: Slice) -> None:
        if not self.portfolio.invested:
            self.set_holdings('SPY', -2)


class MyMarginCallModel(DefaultMarginCallModel):
    def __init__(self,
         portfolio: SecurityPortfolioManager,
         default_order_properties: IOrderProperties):
        super().__init__(portfolio, default_order_properties)

    def execute_margin_call(self,
         generatedMarginCallOrders: List[SubmitOrderRequest]) -> List[OrderTicket]:
        return super().execute_margin_call(generatedMarginCallOrders)

    def get_margin_call_orders(self,
         issue_margin_call_warning: bool | None) -> tuple[List[SubmitOrderRequest], bool]:
        (margin_call_orders, issue_margin_call_warning) = super().get_margin_call_orders(issue_margin_call_warning)
        return (margin_call_orders, issue_margin_call_warning)
</pre>
 <script class="python-result" type="text">
  {}
 </script>
</div>



<h4>
 Other Examples
</h4>
<p>
 For more examples, see the following algorithms:
</p>

  <div class="example-fieldset">
    <div class="example-legend">Demonstration Algorithms</div>
   
    <a class="python example-algorithm-link" href="https://github.com/QuantConnect/Lean/blob/master/Algorithm.Python/MarginCallEventsAlgorithm.py" target="_BLANK">
        MarginCallEventsAlgorithm.py  <span class="badge-python pull-right">Python</span>
    </a>
    
    <a class="csharp example-algorithm-link" href="https://github.com/QuantConnect/Lean/blob/master/Algorithm.CSharp/MarginCallEventsAlgorithm.cs" target="_BLANK">
        MarginCallEventsAlgorithm.cs  <span class="badge badge-sm badge-csharp pull-right">C#</span>
    </a>
    
  </div>
