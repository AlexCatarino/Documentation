<p>Settlement models must extend the <code>ISettlementModel</code> interface. Extensions of the <code>ISettlementModel</code> interface must implement the <code>Scan</code> and <code>ApplyFunds</code> methods. The <code>Scan</code> method is automatically called at the top of each hour and it receives a <code>ScanSettlementModelParameters</code> object. The <code>ApplyFunds</code> method receives an <code>ApplyFundsSettlementModelParameters</code> object and applies the settlement rules. The <code>ApplyFunds</code> method is also automatically called, but its frequency depends on the security type. The <code>ApplyFunds</code> method is automatically called when you fill an order for the following security types:</p>

<ul>
    <li>Equity</li>
    <li>Equity Options</li>
    <li>Crypto</li>
    <li>Forex</li>
    <li>Future Options</li>
    <li>Index Options</li>
</ul>

<p>The <code>ApplyFunds</code> method is automatically called when you close a position for the following security types:</p>

<ul>
    <li>Futures</li>
    <li>Crypto Futures</li>
    <li>CFD</li>
</ul>

<div class="section-example-container">
<pre class='csharp'>// In the Initialize method, set the custom settlement model
security.SetSettlementModel(new MySettlementModel());

// Define the custom settlement model outside of the algorithm
public class MySettlementModel : ISettlementModel
{
    public void ApplyFunds(ApplyFundsSettlementModelParameters applyFundsParameters)
    {
        var currency = applyFundsParameters.CashAmount.Currency;
        var amount = applyFundsParameters.CashAmount.Amount;
        applyFundsParameters.Portfolio.CashBook[currency].AddAmount(amount);
    }

    public void Scan(ScanSettlementModelParameters settlementParameters)
    {
    }
}</pre>
<pre class='python'># In the Initialize method, set the custom settlement model
security.SetSettlementModel(MySettlementModel())

# Define the custom settlement model outside of the algorithm
class MySettlementModel:
    def ApplyFunds(self, applyFundsParameters: ApplyFundsSettlementModelParameters) -> None:
        currency = applyFundsParameters.CashAmount.Currency
        amount = applyFundsParameters.CashAmount.Amount
        applyFundsParameters.Portfolio.CashBook[currency].AddAmount(amount)

    def Scan(self, settlementParameters: ScanSettlementModelParameters) -> None:
        pass</pre>
</div>

<p>For a full example algorithm, see <span class='python'><a href='https://www.quantconnect.com/terminal/processCache?request=embedded_backtest_a27d38bfde7135a8345c8783910be29e.html'>this backtest</a></span><span class='csharp'><a href='https://www.quantconnect.com/terminal/processCache?request=embedded_backtest_d00175b971c1a3f8d498f619944fdcaa.html'>this backtest</a></span>.</p>

<p><code>ApplyFundsSettlementModelParameters</code> objects have the following properties:</p>
<div data-tree="QuantConnect.Securities.ApplyFundsSettlementModelParameters"></div>

<p><code>ScanSettlementModelParameters</code> objects have the following properties:</p>
<div data-tree="QuantConnect.Securities.ScanSettlementModelParameters"></div>

<p>You likely don't need to create a custom settlement model because the <a href='/docs/v2/writing-algorithms/reality-modeling/settlement/supported-models'>supported models</a> already implement immediate and delayed settlement rules.</p>
