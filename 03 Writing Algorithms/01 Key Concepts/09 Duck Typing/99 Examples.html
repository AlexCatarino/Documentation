<p>
 The following examples demonstrate some common practices for duck typing.
</p>
<h4>
 Example 1: Store EMA Indicator
</h4>
<p>
 The following example implements a trend-following strategy using the EMA indicator for the top 20 liquid equities. It uses duck typing to store the EMA indicator in each
 <a href="/docs/v2/writing-algorithms/securities/key-concepts">
  Security object
 </a>
 , so the indicator is discarded together with the
 <code>
  Security
 </code>
 when it is removed from the universe.
</p>
<div class="section-example-container testable">
 <pre class="csharp">public class DuckTypingAlgorithm : QCAlgorithm
{
    private Universe _universe;

    public override void Initialize()
    {
        SetStartDate(2024, 9, 1);
        SetEndDate(2024, 12, 31);
        // Weekly renewal on the universe to allow time to capitalize on the trend.
        UniverseSettings.Schedule.On(DateRules.WeekStart());
        // Trade on the top 20 liquid equities since they have higher volume and price movements.
        _universe = AddUniverse(Universe.DollarVolume.Top(20));
    }

    public override void OnData(Slice slice)
    {
        foreach (var (symbol, security) in _universe.Members)
        {
            // Trade on updated price data.
            if (slice.Bars.TryGetValue(symbol, out var bar))
            {
                var ema = (security as dynamic).ema;
                // Switch to long if the current price is above EMA, suggesting an uptrend.
                if (bar.Close &gt; ema &amp;&amp; !Portfolio[symbol].IsLong)
                {
                    SetHoldings(symbol, 0.025m);
                }
                // Switch to short if the current price is below EMA, suggesting a downtrend.
                else if (bar.Close &lt; ema &amp;&amp; !Portfolio[symbol].IsShort)
                {
                    SetHoldings(symbol, -0.025m);
                }
            }
        }
    }

    public override void OnSecuritiesChanged(SecurityChanges changes)
    {
        foreach (var removed in changes.RemovedSecurities)
        {
            // Liquidate if it is no longer in the top 50 liquidity stocks.
            Liquidate(removed.Symbol);
            // Release resources that update automatic indicators
            DeregisterIndicator(removed.Get&lt;ExponentialMovingAverage&gt;("ema"));
        }
        
        foreach (var added in changes.AddedSecurities)
        {
            // Use duck typing to create an EMA indicator for trend trading.
            // Discarded together when the security is removed from the universe, you won't need to handle it.
            var security = added as dynamic;
            security.ema = EMA(added.Symbol, 60, Resolution.Daily);
            // Warm up the EMA indicator to ensure its readiness for immediate usage.
            WarmUpIndicator(added.Symbol, (ExponentialMovingAverage)security.ema, Resolution.Daily);
        }
    }
}</pre>
 <script class="csharp-result" type="text">
  {
    "Total Orders": "3461",
    "Average Win": "0.11%",
    "Average Loss": "-0.02%",
    "Compounding Annual Return": "-14.523%",
    "Drawdown": "10.000%",
    "Expectancy": "-0.297",
    "Start Equity": "100000",
    "End Equity": "94901.85",
    "Net Profit": "-5.098%",
    "Sharpe Ratio": "-1.107",
    "Sortino Ratio": "-1.405",
    "Probabilistic Sharpe Ratio": "11.808%",
    "Loss Rate": "91%",
    "Win Rate": "9%",
    "Profit-Loss Ratio": "6.70",
    "Alpha": "-0.174",
    "Beta": "0.482",
    "Annual Standard Deviation": "0.136",
    "Annual Variance": "0.018",
    "Information Ratio": "-1.462",
    "Tracking Error": "0.137",
    "Treynor Ratio": "-0.311",
    "Total Fees": "$3479.51",
    "Estimated Strategy Capacity": "$1600000.00",
    "Lowest Capacity Asset": "LLY R735QTJ8XC9X",
    "Portfolio Turnover": "117.25%",
    "Drawdown Recovery": "1",
    "OrderListHash": "db364745e0ca4a01bf57d480e37e085a"
}
 </script>
 <pre class="python">class DuckTypingAlgorithm(QCAlgorithm):
    def initialize(self) -&gt; None:
        self.set_start_date(2024, 9, 1)
        self.set_end_date(2024, 12, 31)
        # Weekly renewal on the universe to allow time to capitalize on the trend.
        self.universe_settings.schedule.on(self.date_rules.week_start())
        # Trade on the top 20 liquid equities since they have higher volume and hence price movements.
        self._universe = self.add_universe(self.universe.dollar_volume.top(20))

    def on_data(self, slice: Slice) -&gt; None:
        for kvp in self._universe.members:
            symbol, security = kvp.key, kvp.value

            # Trade on updated price data.
            bar = slice.bars.get(symbol)
            if bar:
                ema = security.ema.current.value
                # Switch to long if the current price is above EMA, suggesting an uptrend.
                if bar.close &gt; ema and not self.portfolio[symbol].is_long:
                    self.set_holdings(symbol, 0.025)
                elif bar.close &lt; ema and not self.portfolio[symbol].is_short:
                    self.set_holdings(symbol, -0.025)
                
    def on_securities_changed(self, changes: SecurityChanges) -&gt; None:
        for removed in changes.removed_securities:
            # Liquidate if it is not in the top 50 liquidity stocks anymore.
            self.liquidate(removed.symbol)
            # Release resources that update automatic indicators
            self.deregister_indicator(removed.ema)

        for added in changes.added_securities:
            # Use duck typing to create an EMA indicator for trend trading.
            # Discarded together when the security is removed from the universe, you won't need to handle it.
            added.ema = self.ema(added.symbol, 60, Resolution.DAILY)
            # Warm up the EMA indicator to ensure its readiness for immediate usage.
            self.warm_up_indicator(added.symbol, added.ema, Resolution.DAILY)</pre>
 <script class="python-result" type="text">
  {
    "Total Orders": "3461",
    "Average Win": "0.11%",
    "Average Loss": "-0.02%",
    "Compounding Annual Return": "-14.752%",
    "Drawdown": "10.000%",
    "Expectancy": "-0.299",
    "Start Equity": "100000",
    "End Equity": "94817.20",
    "Net Profit": "-5.183%",
    "Sharpe Ratio": "-1.119",
    "Sortino Ratio": "-1.418",
    "Probabilistic Sharpe Ratio": "11.632%",
    "Loss Rate": "91%",
    "Win Rate": "9%",
    "Profit-Loss Ratio": "6.68",
    "Alpha": "-0.176",
    "Beta": "0.481",
    "Annual Standard Deviation": "0.136",
    "Annual Variance": "0.018",
    "Information Ratio": "-1.474",
    "Tracking Error": "0.137",
    "Treynor Ratio": "-0.315",
    "Total Fees": "$3479.48",
    "Estimated Strategy Capacity": "$1600000.00",
    "Lowest Capacity Asset": "LLY R735QTJ8XC9X",
    "Portfolio Turnover": "117.25%",
    "Drawdown Recovery": "1",
    "OrderListHash": "86edb774f420ace0077bc9d0d26abb6a"
}
 </script>
</div>
