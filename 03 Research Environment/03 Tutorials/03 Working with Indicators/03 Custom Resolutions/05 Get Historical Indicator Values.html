<p>We can use Classical Approach to get historical indicator data with custom resolution.</p>

<ol>
    <li>Create a <code>RollingWindow</code> for each indicator to hold their values.</li>
    <p>In this example, we'd like to get the past 50 data points.</p>
    <div class="section-example-container">
        <pre class="csharp">var bbRollingWindow = new RollingWindow&lt;IndicatorDataPoint&gt;(50);
var atrRollingWindow = new RollingWindow&lt;IndicatorDataPoint&gt;(50);
var vwapRollingWindow = new RollingWindow&lt;IndicatorDataPoint&gt;(50);
var smaOfRsiRollingWindow = new RollingWindow&lt;IndicatorDataPoint&gt;(50);</pre>
        <pre class="python">bb_rolling_window = RollingWindow[IndicatorDataPoint](50)
atr_rolling_window = RollingWindow[IndicatorDataPoint](50)
vwap_rolling_window = RollingWindow[IndicatorDataPoint](50)
sma_of_rsi_rolling_window = RollingWindow[IndicatorDataPoint](50)</pre>
    </div>

    <li>Set handler methods to update the <code>RollingWindow</code>s.</li>
    <div class="section-example-container">
        <pre class="csharp">// We want to save BandWidth data for BollingerBands.
private void UpdateBollingerBandWindow(object sender, IndicatorDataPoint updated){
    var bb_ = sender as BollingerBands;
    bbRollingWindow.Add(bb_.BandWidth.Current);
}
bb.Updated += UpdateBollingerBandWindow;
atr.Updated += (sender, updated) => atrRollingWindow.Add(updated);
vwap.Updated += (sender, updated) => vwapRollingWindow.Add(updated);
smaOfRsi.Updated += (sender, updated) => smaOfRsiRollingWindow.Add(updated);</pre>
        <pre class="python"># We want to save BandWidth data for BollingerBands.
def UpdateBollingerBandWindow(sender, updated):
    bb_ = sender;
    bb_rolling_window.Add(bb_.BandWidth.Current);

bb.Updated += UpdateBollingerBandWindow;
atr.Updated += lambda sender, updated: atr_rolling_window.Add(updated)
vwap.Updated += lambda sender, updated: vwap_rolling_window.Add(updated)
sma_of_rsi.Updated += lambda sender, updated: sma_of_rsi_rolling_window.Add(updated)</pre>
    </div>
    <p>When the indicators receive new data, the handler will add the new <code>IndicatorDataPoints</code> into the <code>RollingWindow</code>s.</p>

    <li>Create a <code>TradeBarConsolidator</code> to get 7-day bar data.</li>
    <div class="section-example-container">
        <pre class="csharp">var consolidator = new TradeBarConsolidator(TimeSpan.FromDays(7));</pre>
        <pre class="python">consolidator = TradeBarConsolidator(timedelta(days=7))</pre>
    </div>

    <li>Set a handler method for the consolidator to update the indicators.</li>
    <div class="section-example-container">
        <pre class="csharp">private void ConsolidatorHandler(object sender, TradeBar consolidated){
    // Update the indicators
    bb.Update(consolidated.EndTime, consolidated.Close);
    atr.Update(consolidated);
    vwap.Update(consolidated);
    rsi.Update(consolidated.EndTime, consolidated.Close);    // We update the "base" indicator for a combined indicator.
}
consolidator.DataConsolidated += ConsolidatorHandler;</pre>
        <pre class="python">def ConsolidatorHandler(sender, consolidated):
    # Update the indicators
    bb.Update(consolidated.EndTime, consolidated.Close)
    atr.Update(consolidated)
    vwap.Update(consolidated)
    rsi.Update(consolidated.EndTime, consolidated.Close)    # We update the "base" indicator for a combined indicator.
    
consolidator.DataConsolidated += ConsolidatorHandler </pre>
    </div>
    <p>When the consolidator consolidates a new bar, the handler will update the indicators with the consolidated bar.</p>

    <li>Get historical <code class="csharp">TradeBar</code><code class="python">Slice</code> for the last 70*7 days to warm-up the indicators and get the datapoints we'd like to study.</li>
    <div class="section-example-container">
        <pre class="csharp">var history = qb.History&lt;TradeBar&gt;(symbol, TimeSpan.FromDays(70*7), Resolution.Daily);</pre>
        <pre class="python">history = qb.History(symbol, timedelta(days=70*7), Resolution.Daily)</pre>
    </div>

    <li>Iterate each slice to update the indicators and the <code>RollingWindow</code>s.</li>
    <div class="section-example-container">
        <pre class="csharp">foreach(var bar in history){
    // # Feed the data slice into the consolidator.
    consolidator.Update(bar);
}</pre>
        <pre class="python">for bar in history.itertuples():
    # get the EndTime.
    date = bar.Index[1]    
    # Reconstruct a TradeBar object.
    trade_bar = TradeBar(date, symbol, bar.open, bar.high, bar.low, bar.close, bar.volume)
    
    # Feed the data slice into the consolidator.
    consolidator.Update(trade_bar)</pre>
    </div>

    <li class="csharp">Display the data.</li>
    <div class="csharp section-example-container">
        <pre class="csharp">foreach(var point in bbRollingWindow.Take(5)){
    Console.WriteLine($"Bollinger Band Width: {point.Time}: {point.Value}");
}
foreach(var point in atrRollingWindow.Take(5)){
    Console.WriteLine($"Average True Range: {point.Time}: {point.Value}");
}
foreach(var point in vwapRollingWindow.Take(5)){
    Console.WriteLine($"VWAP: {point.Time}: {point.Value}");
}
foreach(var point in smaOfRsiRollingWindow.Take(5)){
    Console.WriteLine($"SMA of RSI: {point.Time}: {point.Value}");
}</pre>
    </div>
    <img class="csharp" src="https://cdn.quantconnect.com/i/tu/indicator-custom-resolution-cs-classic.png">

    <li class="python">Convert the <code>RollingWindow</code>s' data into <code>pandas.DataFrame</code>.</li>
    <div class="python section-example-container">
        <pre class="python">bb_df = pd.DataFrame([point.Value for point in bb_rolling_window], 
                     index=[point.Time for point in bb_rolling_window],
                     columns=["Bollinger Band Width"])[::-1]       # Reverse the order.

atr_df = pd.DataFrame([point.Value for point in atr_rolling_window], 
                      index=[point.Time for point in atr_rolling_window],
                      columns=["Average True Range"])[::-1]

vwap_df = pd.DataFrame([point.Value for point in vwap_rolling_window], 
                       index=[point.Time for point in vwap_rolling_window],
                       columns=["Volume Weighted Average Price"])[::-1]

sma_of_rsi_df = pd.DataFrame([point.Value for point in sma_of_rsi_rolling_window], 
                             index=[point.Time for point in sma_of_rsi_rolling_window],
                             columns=["SMA of RSI"])[::-1]</pre>
    </div>

    <li class="python">Combine the <code>DataFrame</code> to have a look.</li>
    <div class="python section-example-container">
        <pre class="python">df = pd.concat([bb_df,
               atr_df,
               vwap_df,
               sma_of_rsi_df],
              axis=1)</pre>
    </div>
    <img class="python" src="https://cdn.quantconnect.com/i/tu/indicator-custom-resolution-py-classic.png">
</ol>