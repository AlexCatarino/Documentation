<p>Universes are data types. To get historical data for a universe, pass the universe data type to the <code>UniverseHistory</code> method. The object that returns contains a universe data collection for each day. With this object, you can iterate through each day and then iterate through the universe data objects of each day to analyze the universe constituents.</p>

<p>For example, follow these steps to get the US Equity Fundamental data for a specific universe:</p>

<ol>
    <li class='csharp'>Load the assembly files and data types in their own cell.</li>
    <div class="csharp section-example-container">
        <pre class="csharp">#load "../Initialize.csx"</pre>
    </div>

    <li class='csharp'>Load the necessary assembly files.</li>
    <div class="csharp section-example-container">
        <pre class="csharp">#load "../QuantConnect.csx"</pre>
    </div>

    <li class='csharp'>Import the <code>QuantConnect</code> package and the universe data type.</li>
    <div class="csharp section-example-container">
        <pre class="csharp">using QuantConnect;
using QuantConnect.Research;
using QuantConnect.Data.Fundamental;</pre>
    </div>
    
    <li>Create a <code>QuantBook</code>.</li>
    <div class="section-example-container">
        <pre class="csharp">var qb = new QuantBook();</pre>
        <pre class="python">qb = QuantBook()</pre>
    </div>

    <li>Define a universe selection function.</li>
    <p>The following example defines a dynamic universe that contains the 10 Equities with the lowest PE ratios in the market. To see all the <code>Fundamental</code> attributes you can use to define a filter function for a Fundamental universe, see <a href='/docs/v2/writing-algorithms/datasets/morningstar/us-fundamental-data#05-Data-Point-Attributes'>Data Point Attributes</a>.</p>
    <div class="section-example-container">
    <pre class="csharp">IEnumerable&lt;Symbol&gt; FilterFunction(IEnumerable&lt;Fundamental&gt; fundamentals) 
{
    return fundamentals
        .Where(f => f.HasFundamentalData)
        .OrderBy(f => f.ValuationRatios.PERatio)
        .Take(10)
        .Select(f => f.Symbol);
}</pre>
    <pre class="python">def filter_function(fundamentals: List[Fundamental]) -> List[Symbol]:
    sorted_by_pe_ratio = sorted(
        [f for f in fundamentals if f.HasFundamentalData], 
        key=lambda fundamental: fundamental.ValuationRatios.PERatio
    )
    return [fundamental.Symbol for fundamental in sorted_by_pe_ratio[:10]]</pre>
    </div>

    <li>Call the <code class='csharp'>UniverseHistory&lt;Fundamentals, Fundamental&gt;</code><code class='python'>UniverseHistory</code> method with <span class='python'>the <code>Fundamentals</code> type,</span> a start date, an end date, and the universe selection function.</li>
    <div class="section-example-container">
        <pre class="csharp">var universeHistory = qb.UniverseHistory&lt;Fundamentals, Fundamental&gt;(new DateTime(2023, 11, 6), new DateTime(2023, 11, 13), FilterFunction);</pre>
        <pre class="python">universe_history = qb.UniverseHistory(Fundamentals, datetime(2023, 11, 6), datetime(2023, 11, 13), filter_function)</pre>
    </div>

    <p>
    The end date and filter function arguments are optional. 
    If you omit the end date argument, the method returns <code>Fundamental</code> data between the start date and the current day. 
    If you omit the filter function argument, the method returns <code>Fundamental</code> data for all US Equities that were trading between the start and end dates, including delisted securities.
    </p>

    <p class='python'>The <code>UniverseHistory</code> method returns a DataFrame where the index is the time when universe selection would occur in a backtest. The DataFrame has one column, named "data". Each row in the data column contains a list of <code>Fundamental</code> objects. The following image shows the first 5 rows of an example DataFrame:</p>
    <img class="python docs-image" src="https://cdn.quantconnect.com/i/tu/universe-selection-history-dataframe-python.png" alt="Historical fundamental universe dataframe">
    <p class='csharp'>The <code>UniverseHistory&lt;Fundamentals, Fundamental&gt;</code> method returns an <code>IEnumerable&lt;IEnumerable&lt;Fundamental&gt;&gt;</code> object. </p>

    <li class='python'>Iterate through the DataFrame to access the universe data.</li>
    <li class='csharp'>Iterate through the result to access the universe data.</li>

    <div class="section-example-container">
    <pre class="python">for date, fundamentals in universe_history.iterrows():
    for fundamental in fundamentals['data']:
        symbol = fundamental.Symbol
        price = fundamental.Price
        if fundamental.HasFundamentalData:
            pe_ratio = fundamental.ValuationRatios.PERatio</pre>
    <pre class="csharp">foreach (var fundamentals in universeHistory)
{
    foreach (var fundamental in fundamentals)
    {
        var symbol = fundamental.Symbol;
        var price = fundamental.Price;
        if (fundamental.HasFundamentalData)
        {
            var peRatio = fundamental.ValuationRatios.PERatio;
        }
    }
}</pre>
    </div>
</ol>
